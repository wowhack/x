<!DOCTYPE>
<html>
  <head>
    <meta charset="utf-8">
    
    <link rel="stylesheet" href="style.css">
    
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/themes/smoothness/jquery-ui.css" />
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.0/jquery-ui.min.js"></script>

    <script type="text/javascript">
      $( document ).ready(function() {
        
          $('.draggable').draggable({containment: "parent"});
          $('.imgcontainer').resizable({ iframeFix: true });

        $(".movie").resizable({
          start: function(event, ui) {
            ui.element.append($("<div/>", {
              id: "iframe-barrier",
              css: {
                "z-index": 10
              }
            }));
          },
          stop: function(event, ui) {
            $("#iframe-barrier", ui.element).remove();
          },
          resize: function(event, ui) {
            $(".move iframe", ui.element).width(ui.size.width).height(ui.size.height);
          }
        });
          
      });  
      
    </script>

  </head>
  <body>



    <div class="top">
      
    </div>

    <div class="boardcontent">

<!--       <div class="polaroid draggable imgcontainer"><span class="pin"></span><img src="http://placekitten.com/g/600/600" alt=""></div>


    <div class="polaroid draggable imgcontainer"><span class="pin"></span><img src="http://placekitten.com/g/400/400" width="400" height="400" alt=""></div>
    

    <div class="frame movie draggable" style="width: 560px; height: 315px;"><iframe width="560" height="315" src="//www.youtube.com/embed/Kdgt1ZHkvnM" frameborder="0"> </iframe></div>

    <div class="frame track draggable"><iframe src="https://embed.spotify.com/?uri=spotify:track:7cmMZ45nWU8JtvdIzgXlli" width="300" height="380" frameborder="0" allowtransparency="true"></iframe></div> -->
    </div>
    <div id="board"></div>

   
    <script>
      $(function() {
        $.get('/board', function (board) {
          console.log('loading board with id: ' + board.boardId);
          for (var i = 0; i < board.items.length; i += 1) {
            var item = board.items[i];
            addItem(item);
          }
        });

        var host = location.origin.replace(/^http/, 'ws')
        var ws = new WebSocket(host);
        ws.onmessage = function (event) {
          console.log(event);
          addItem(JSON.parse(event.data));
        };


      });

      var addItem = function(item) {
        console.log(item.type);
        if (item.type === 'IMAGE') {
          addImage(item);
        }
        if (item.type === 'YOUTUBE') {
          addYoutube(item);
        }
        if (item.type === 'SPOTIFY') {
          addSpotify(item);
        }
      };

      var addImage = function(imageItem) {
        $('.boardcontent').append('<div class="polaroid draggable imgcontainer"><span class="pin"></span><img src="' + imageItem.url + '"></div>');
      };

      var addYoutube = function(youtubeItem) {
        $('.boardcontent').append(' <div class="frame movie draggable" style="width: 400px; height: 300px;"><iframe width="400" height="300" src="//www.youtube.com/embed/' + youtubeItem.videoId + '" frameborder="0" allowfullscreen></iframe></div>');
      };

      var addSpotify = function(spotifyItem) {
        $('.boardcontent').append('<div class="frame track draggable"><iframe src="https://embed.spotify.com/?uri=' + spotifyItem.uri + '" width="300" height="380" frameborder="0" allowtransparency="true"></iframe></div>');
      }
    </script>
  </body>
</html>